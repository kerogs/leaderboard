<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>leaderboard | Five'sTv </title>
    <link rel="stylesheet" href="./src/css/style.css">
    <link rel="shortcut icon" href="./src/img/logo.png" type="image/x-icon">
</head>

<body>

    <!-- customMenu -->
    <div class="custom-menu" id="custom-menu">
        <ul>

            <li id="retirer">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path
                        d="M5 2c-1.103 0-2 .897-2 2v12c0 1.103.897 2 2 2h3.5l3.5 4 3.5-4H19c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2H5zm11 9H8V9h8v2z">
                    </path>
                </svg>
                Retirer
            </li>

            <li id="modifier">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path
                        d="M9 22h1v-2h-.989C8.703 19.994 6 19.827 6 16c0-1.993-.665-3.246-1.502-4C5.335 11.246 6 9.993 6 8c0-3.827 2.703-3.994 3-4h1V2H8.998C7.269 2.004 4 3.264 4 8c0 2.8-1.678 2.99-2.014 3L2 13c.082 0 2 .034 2 3 0 4.736 3.269 5.996 5 6zm13-11c-.082 0-2-.034-2-3 0-4.736-3.269-5.996-5-6h-1v2h.989c.308.006 3.011.173 3.011 4 0 1.993.665 3.246 1.502 4-.837.754-1.502 2.007-1.502 4 0 3.827-2.703 3.994-3 4h-1v2h1.002C16.731 21.996 20 20.736 20 16c0-2.8 1.678-2.99 2.014-3L22 11z">
                    </path>
                </svg>
                Modifier
            </li>

            <hr>

            <li id="inverser">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M8 16H4l6 6V2H8zm6-11v17h2V8h4l-6-6z"></path>
                </svg>
                Inverser
            </li>

        </ul>
    </div>

    <!-- nav -->
    <div class="container">
        <div class="left">
            <img src="./src/img/logo.png" alt="">

            <ul>
                <a href="index.html">
                    <li class="active">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <path d="M4 7h16v2H4zm0-4h16v2H4zm0 8h16v2H4zm0 4h16v2H4zm2 4h12v2H6z"></path>
                        </svg>
                        Tableau des scores
                    </li>
                </a>

                <a href="">
                    <li class="">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <path
                                d="M20 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zm-1 16H5V5h14v14z">
                            </path>
                            <path d="M11 7h2v2h-2zm0 4h2v6h-2z"></path>
                        </svg>
                        Information
                    </li>
                </a>

                <a href="debug.html">
                    <li class="">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <path
                                d="m20.496 6.106-7.973-4a.997.997 0 0 0-.895-.002l-8.027 4c-.297.15-.502.437-.544.767-.013.097-1.145 9.741 8.541 15.008a.995.995 0 0 0 .969-.009c9.307-5.259 8.514-14.573 8.476-14.967a1 1 0 0 0-.547-.797z">
                            </path>
                        </svg>
                        Debug
                    </li>
                </a>
            </ul>

            <div class="bottom">
                <p class="github">
                    <a href="https://github.com/kerogs/leaderboard" target="_blank">
                        By Kerogs
                    </a>
                    <br>
                    <span>Version 0.1</span>
                </p>
            </div>
        </div>



        <!-- tableau des scores -->
        <div class="center">
            <div class="subcontainer">
                <h1>Tableau des scores</h1>
                <table id="content">
                    <thead>
                        <th>R.</th>
                        <th>Joueur</th>
                        <th>Score</th>
                    </thead>
                    <tbody>
                        <!-- <tr data-id="294720fdj49">
                            <td><span>1</span></td>
                            <td>Kerogs</td>
                            <td>1920 pts</td>
                        </tr>
                        <tr>
                            <td><span>2</span></td>
                            <td>Kerogs</td>
                            <td>1920 pts</td>
                        </tr>
                        <tr>
                            <td><span>3</span></td>
                            <td>Kerogs</td>
                            <td>1920 pts</td>
                        </tr> -->
                    </tbody>
                </table>
            </div>
        </div>



        <!-- settings -->
        <div class="right">
            <section>
                <form action="" id="add">
                    <h3 for="">Ajouter un joueur</h3>
                    <input type="text" name="pseudo" id="pseudo" placeholder="Pseudo">
                    <input type="text" name="score" id="score" placeholder="Score">
                    <input type="submit" value="Ajouter">
                </form>
            </section>

            <section>
                <form action="" id="purge">
                    <input class="red" type="submit" value="Purger">
                </form>
            </section>
        </div>
    </div>

</body>
<!-- script -->
<script src="./src/js/tbs.js"></script>
<script>

document.addEventListener('DOMContentLoaded', function () {
            const content = document.getElementById('content');
            const addForm = document.getElementById('add');
            const purgeForm = document.getElementById('purge');

            // Charger les données du leaderboard depuis le fichier JSON local
            function loadLeaderboardData() {
                fetch('./data/leaderboard.json')
                    .then(response => response.json())
                    .then(data => {
                        // Afficher les données dans le tableau
                        data.forEach(player => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${player.id}</td>
                                <td>${player.joueur}</td>
                                <td>${player.score}</td>
                            `;
                            content.appendChild(row);
                        });
                    })
                    .catch(error => console.error('Erreur lors du chargement des données du leaderboard :', error));
            }

            // Enregistrer les données du joueur dans le fichier JSON local
            function savePlayerData(player) {
                fetch('./data/leaderboard.json', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(player)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors de l\'enregistrement des données du joueur.');
                    }
                    console.log('Données du joueur enregistrées avec succès.');
                })
                .catch(error => console.error(error));
            }

            // Gestionnaire d'événements pour ajouter un joueur
            addForm.addEventListener('submit', function (event) {
                event.preventDefault(); // Empêcher le comportement par défaut du formulaire
                const pseudo = document.getElementById('pseudo').value;
                const score = parseInt(document.getElementById('score').value);
                const player = {
                    id: Math.random().toString(36).substr(2, 9), // Générer un ID aléatoire
                    joueur: pseudo,
                    score: score
                };
                savePlayerData(player); // Enregistrer les données du joueur
            });

            // Gestionnaire d'événements pour purger les données du leaderboard
            purgeForm.addEventListener('submit', function (event) {
                event.preventDefault(); // Empêcher le comportement par défaut du formulaire
                // Purger les données en écrivant un tableau vide dans le fichier JSON
                fetch('./data/leaderboard.json', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify([])
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors de la purge des données du leaderboard.');
                    }
                    console.log('Données du leaderboard purgées avec succès.');
                })
                .catch(error => console.error(error));
            });

            // Charger les données du leaderboard lors du chargement de la page
            loadLeaderboardData();
        });





    document.addEventListener('DOMContentLoaded', function () {
        // Fonction pour mettre à jour les données du tableau
        function updateTable() {
            // Récupérer le tbody du tableau
            var tbody = document.querySelector("table tbody");

            // Effacer le contenu actuel du tbody
            tbody.innerHTML = "";

            // Récupérer les données existantes du cookie
            var userData = JSON.parse(localStorage.getItem('userData')) || [];

            // Parcourir les données et les ajouter au tableau
            userData.forEach(function (user) {
                // Créer une nouvelle ligne pour l'utilisateur
                var newRow = document.createElement("tr");

                // Ajouter un attribut data-id avec l'identifiant unique
                newRow.setAttribute("data-id", user.id);

                // Créer les cellules pour le rang, le pseudo et le score
                var rankCell = document.createElement("td");
                var userCell = document.createElement("td");
                var scoreCell = document.createElement("td");

                // Assigner les valeurs aux cellules
                rankCell.innerHTML = "-";
                userCell.innerHTML = user.pseudo;
                scoreCell.innerHTML = user.score + " pts";

                // Ajouter les cellules à la nouvelle ligne
                newRow.appendChild(rankCell);
                newRow.appendChild(userCell);
                newRow.appendChild(scoreCell);

                // Ajouter la nouvelle ligne au tbody du tableau
                tbody.appendChild(newRow);
            });

            // Mettre à jour le classement après avoir chargé les données
            updateRanking();
        }

        // Exécuter la fonction updateTable toutes les secondes
        setInterval(updateTable, 1000);
    });

</script>

</html>